---
layout:     post
title:      KVO详解
subtitle:   2024-01-25国药赢创技术故障记录
date:       2024-01-25
author:     BY
header-img: img/post-bg-cook.jpg
catalog: true
tags:
    - 运维
---

## 背景
来到这家公司，所接手的项目却是一堆烂摊子，公司开发的1.0产品，是外包给外面的团队做的，没有什么的交接，没有源码，就一个线上运行的机器，数据库账号密码都是我去机器上找到的，问题层出不穷，最多的两个问题是：1、国内访问时不时访问不了。2、短信收不到验证码。

## 解决国内访问稳定问题
这个问题其原因是，域名是挂在国外的一家CDN上的（查过，一会儿在美国，一会儿可能在巴西），国内访问要绕大半个地球，网路不稳定时一定的。首先我在机器上发现nginx配置里有一个直接解析到机器的（机器在香港），所以我就换成这个，刚开始用着还可以，网络很稳定，但是第二天同事就反映需要挂vpn才能访问，1.23号那天我正好发烧生病，没法这些事情没人解决得了，我在家通过ssh远程过去，发现进去不了，一开始我以为是被黑客攻击，后面才知道IP被封。一件事情还没有解决好，又带来一推事情。

## 解决短信验证码收不到问题
接着上面讲，现在面临的问题很棘手，ip被封，机器登录不上，两手准备，一是：去找vpn，试图通过vpn方式上去。二是：和服务器提供商联系，协商更换ip的事情。最终选择了更换ip方式，这种方案一劳永逸。在排查问题时，我也在搜索为啥ip被封，查到如果域名没有备案，在国内访问国外的网站,IP是容易被封，一般发生在节假日左右。我因此重新换上了新的备案域名，总算解决了域名问题、访问不稳定问题。
回到短信验证码收不到问题，这个很棘手，界面现象就是发送验证码时，出现超时弹窗，接口发不出去，我一时没了主意，就想着去联系3t那个胡总，胡总也是有一句没一句，打了电话也是敷衍了事，这里也是有故事，就不说了，乱得很。后面经过排查，发现原来是短信域名被代理出去了，代理位置就是在/etc/hosts文件里

